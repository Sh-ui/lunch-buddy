{% extends 'base.html' %}
{% block title %}Pantry{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="m-0">Pantry</h2>
  <a class="btn btn-primary rounded-4" href="{% url 'meal_create' %}">Add Meal</a>
  <style>.btn-primary{background-color:var(--brand);border-color:var(--brand-dark)}</style>
</div>

<form class="row g-2 mb-3" method="get">
  <div class="col-md-6">
    <input type="text" class="form-control rounded-4" name="q" value="{{ q }}" placeholder="Search meals...">
  </div>
  <div class="col-md-4">
    <select class="form-select rounded-4" name="category">
      <option value="">All categories</option>
      {% for c in categories %}
        <option value="{{ c.id }}" {% if category_id|default:'' == c.id|stringformat:'s' %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <button class="btn btn-outline-secondary w-100 rounded-4" type="submit">Filter</button>
  </div>
  {% csrf_token %}
  </form>

<div class="row">
  {% for meal in meals %}
  <div class="col-md-6 col-lg-4 mb-3">
    <div class="card card-elev rounded-4">
      <div class="card-body d-flex flex-column gap-2">
        <div class="d-flex justify-content-between align-items-center">
          <strong>{{ meal.name }}</strong>
          <span class="badge text-bg-light">{{ meal.category.name }}</span>
        </div>
        <div class="d-flex gap-2">
          <form method="post" action="{% url 'toggle_heart' meal.id %}">
            {% csrf_token %}
            <button class="btn btn-sm rounded-4 {{ meal.is_hearted|yesno:'btn-warning,btn-outline-secondary' }}" type="submit">‚ù§</button>
          </form>
          <a class="btn btn-sm btn-outline-primary rounded-4" href="{% url 'meal_update' meal.id %}">Edit</a>
          <form method="post" action="{% url 'toggle_archive' meal.id %}">
            {% csrf_token %}
            <button class="btn btn-sm rounded-4 {{ meal.is_archived|yesno:'btn-danger,btn-outline-secondary' }}" type="submit">Archive</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  {% empty %}
  <div class="col-12"><div class="alert alert-info rounded-4">No meals yet. Add your first one!</div></div>
  {% endfor %}
</div>
{% endblock %}


